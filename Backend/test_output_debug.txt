Starting test_ambiguity.py execution...
Importing modules...
Modules imported successfully.
Entering main block...
Running test_no_ambiguity...
test_no_ambiguity passed.
Running test_detection_and_clarification...
Clearing preferences...
Removing D:\BASQ-V\Backend\app\ambiguity\preferences.json
[DEBUG] Term: 'last year', Confidence: 0.0, Preference: 'None', Should Ask: True
[DEBUG] Term: 'revenue', Confidence: 0.0, Preference: 'None', Should Ask: True
test_detection_and_clarification passed.
Running test_learning_and_resolution...
Clearing preferences...
No preferences file to remove.
  Substep 1: Query needs clarification
[DEBUG] Term: 'last year', Confidence: 0.0, Preference: 'None', Should Ask: True
[DEBUG] Term: 'revenue', Confidence: 0.0, Preference: 'None', Should Ask: True
  Substep 2: Handling response
  Substep 3: Re-querying
[DEBUG] Term: 'last year', Confidence: 1.0, Preference: 'Fiscal Year', Should Ask: False
[DEBUG] Term: 'revenue', Confidence: 0.0, Preference: 'None', Should Ask: True
Test failed: 
Traceback (most recent call last):
  File "D:\BASQ-V\Backend\app\ambiguity\test_ambiguity.py", line 70, in <module>
    test_learning_and_resolution()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\BASQ-V\Backend\app\ambiguity\test_ambiguity.py", line 61, in test_learning_and_resolution
    assert result["status"] == "auto_resolved"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError
